<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MedBot - AI Doctor</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: #f4f7f6; margin: 0; padding: 20px; display: flex; justify-content: center; align-items: center; min-height: 100vh; box-sizing: border-box; }
        #chat-container { width: 100%; max-width: 600px; background-color: #ffffff; border-radius: 12px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05); display: flex; flex-direction: column; overflow: hidden; height: 80vh; }
        header { background-color: #007aff; color: white; padding: 16px 20px; text-align: center; font-size: 1.2rem; font-weight: 600; }
        #chat-box { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 15px; }
        .message { padding: 10px 15px; border-radius: 18px; max-width: 80%; line-height: 1.5; white-space: pre-wrap; }
        .user-message { background-color: #e5f2ff; color: #005bb5; align-self: flex-end; border-bottom-right-radius: 4px; }
        .bot-message { background-color: #f1f1f1; color: #333; align-self: flex-start; border-bottom-left-radius: 4px; }
        #input-container { display: flex; padding: 20px; border-top: 1px solid #e0e0e0; background-color: #f9f9f9; }
        #user-input { flex: 1; padding: 10px 15px; border: 1px solid #ccc; border-radius: 20px; margin-right: 10px; font-size: 1rem; }
        #send-btn { padding: 10px 20px; background-color: #007aff; color: white; border: none; border-radius: 20px; cursor: pointer; font-size: 1rem; }
        #send-btn:disabled { background-color: #c0c0c0; }
    </style>
</head>
<body>
    <div id="chat-container">
        <header>MedBot</header>
        <div id="chat-box">
            <div class="message bot-message">
                Hello! I am MedBot. You can ask me medical questions.
            </div>
        </div>
        <div id="input-container">
            <input type="text" id="user-input" placeholder="Ask a medical question...">
            <button id="send-btn">Send</button>
        </div>
    </div>

    <script type="module">
        import {
            GoogleGenerativeAI,
            HarmCategory,
            HarmBlockThreshold,
        } from "https://cdn.jsdelivr.net/npm/@google/generative-ai@0.11.3/dist/index.js";

        // --- Your hardcoded API key ---
        const API_KEY = "AIzaSyA6DFJyOIi_3Q5-JyCKb_IgxDNbStF_gW8";

        // --- DOM Elements ---
        const chatBox = document.getElementById("chat-box");
        const userInput = document.getElementById("user-input");
        const sendBtn = document.getElementById("send-btn");
        
        let generativeModel;
        let chat;

        function setupAI() {
            try {
                const genAI = new GoogleGenerativeAI(API_KEY);
                
                generativeModel = genAI.getGenerativeModel({
                    // --- THIS IS THE FIX ---
                    // Using the new model name
                    model: "gemini-1.5-flash", 
                    
                    systemInstruction: "You are doctor and answer the question asked by the user politly and give answers from the reference of Gale encyclopedia of medicine book",
                    generationConfig: {
                        temperature: 0.1,
                    },
                });

                chat = generativeModel.startChat({ history: [] });

                // If successful, enable the chat
                userInput.disabled = false;
                sendBtn.disabled = false;

            } catch (error) {
                console.error(error); // The real error is here
                appendMessage("Error setting up AI. Check the console (F12) for details. " + error.message, "bot");
                userInput.disabled = true;
                sendBtn.disabled = true;
            }
        }

        async function sendMessage() {
            const userPrompt = userInput.value.trim();
            if (!userPrompt) return;

            appendMessage(userPrompt, "user");
            userInput.value = "";
            sendBtn.disabled = true;

            const thinkingMessage = appendMessage("MedBot is thinking...", "bot");

            try {
                const result = await chat.sendMessage(userPrompt);
                const response = result.response;
                const botText = response.text();
                thinkingMessage.textContent = botText;

            } catch (error) {
                console.error(error);
                thinkingMessage.textContent = "Sorry, an error occurred: " + error.message;
            } finally {
                sendBtn.disabled = false;
                userInput.focus();
            }
        }

        function appendMessage(text, sender) {
            const messageDiv = document.createElement("div");
            messageDiv.classList.add("message", `${sender}-message`);
            messageDiv.textContent = text;
            chatBox.appendChild(messageDiv);
            chatBox.scrollTop = chatBox.scrollHeight;
            return messageDiv;
        }

        sendBtn.addEventListener("click", sendMessage);
        userInput.addEventListener("keydown", (e) => {
            if (e.key === "Enter" && !sendBtn.disabled) {
                sendMessage();
            }
        });

        userInput.disabled = true;
        sendBtn.disabled = true;
        setupAI();

    </script>
</body>
</html>